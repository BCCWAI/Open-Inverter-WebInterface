<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Huebner Inverter</title>
        <meta name="viewport" content="initial-scale=1.0; maximum-scale=1.0; width=device-width;">

        <link rel="stylesheet" type="text/css" href="css/style.css" />
        <link rel="stylesheet" type="text/css" href="css/slicknav.css" />
        <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
        <link rel="stylesheet" type="text/css" href="css/bootstrap-editable.css" />
        <link rel="stylesheet" type="text/css" href="css/tooltipster.css" />

        <script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript" src="js/main.js"></script>
        <script type="text/javascript" src="js/jquery.slicknav.js"></script>
        <script type="text/javascript" src="js/bootstrap.js"></script>
        <script type="text/javascript" src="js/bootstrap-editable.js"></script>
        <script type="text/javascript" src="js/tooltipster.js"></script>
        
        <script>
        
            //$.fn.editable.defaults.url = 'serial.php';
            //$.fn.editable.defaults.ajaxOptions = {type: "PUT"};
            //$.fn.editable.defaults.mode = 'inline';
            $.fn.editable.defaults.mode = 'popup';
            
            $(document).ready(function()
            {
                $('#parameters').editable({
                    selector: 'a',
                    url: 'serial.php',
                    pk: 1,
                    showbuttons: true,
                    ajaxOptions: {
                        type: 'get',
                        //type: 'put',
                        //dataType: 'json'
                    },
                    success: function(response, newValue) {
                        //console.log(response);
                        if(response.indexOf("Set OK"))
                        {
                            var id = this.id;
                            //console.log(this.id);

                            $("#" + id).addClass('alert-warning');
                            var span = $("<span>", { class:"label label-warning col-sm-offset-2"}).append("changed");
                            $("#" + id).parent().append(span);
                            
                            setTimeout(function(){

                                $.ajax("serial.php?save=1",{
                                    success: function(data)
                                    {
                                        //console.log(data);
                                        $("#" + id).removeClass('alert-warning');
                                        span.removeClass('label-warning');

                                        if(data.indexOf("Parameters stored") != -1)
                                        {
                                            $("#" + id).addClass('alert-success');
                                            span.addClass('label-success');
                                            span.text("saved");
                                        }else{
                                            $("#" + id).addClass('alert-danger');
                                            span.addClass('label-danger');
                                            span.text("error");
                                        }
                                    }
                                });
                            },2000);
                            setTimeout(function(){
                                span.remove();
                            },5000);
                        }
                    }
                });

                loadJSON();
            });
        </script>
    </head>

    <body>
        <ul id="menu">
            <li id="startInverter"><a href="#" onClick="startInverter()">Start Inverter</a></li>
            <li id="stopInverter"><a href="#" onClick="stopInverter()">Stop Inverter</a></li>
            <!--
            <li><a href="#">Save Parameters to Flash</a></li>
            <li><a href="#">Save Parameters from Flash</a></li>
            -->
            <li><a href="upload.html">Upload Parameters</a></li>
            <li><a href="download.php">Download Parameters</a></li>
            <li><a href="index.html">Advanced Parameters</a></li>
            <!--
            <li><a href="simple.html">Simple Parameters</a></li>
            -->
            <!--
            <li><a href="graph.html">Show Graph</a></li>
            -->
            <li><a href="wiring.html">Wiring Diagram</a></li>
            <li><a href="encoder.html">Build Encoder</a></li>
        </ul>

        <div class="col-md-12 col-sm-12 col-xs-12">
            <br/>
            <div class="center-block" id="title">
                <h3 class="label">Inverter Console</h3><span id="titleStatus" class="label col-sm-offset-1"></span>
            </div>
            <br/>
            <table class="table table-bordered table-striped table-hover" style="clear: both; background-color:#e6e6e6;" id="parameters">
                <thead class="thead-inverse">
                    <tr>
                        <th>Name</th>
                        <th>Value</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </body>
</html>