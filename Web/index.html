<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Huebner Inverter</title>

        <link rel="stylesheet" type="text/css" href="css/style.css" />
        <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
        <link rel="stylesheet" type="text/css" href="css/bootstrap-responsive.css" />
        <link rel="stylesheet" type="text/css" href="css/bootstrap-editable.css" />
        <link rel="stylesheet" type="text/css" href="css/tooltipster.css" />

        <script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript" src="js/main.js"></script>
 
        <script type="text/javascript" src="js/bootstrap.js"></script>
        <script type="text/javascript" src="js/bootstrap-editable.js"></script>
        <script type="text/javascript" src="js/tooltipster.js"></script>
        
        <script>
        
            $(document).ready(function()
            {
                $('#parameters').editable({
                    selector: 'a',
                    url: 'serial.php',
                    mode: 'popup',
                    pk: 1,
                    showbuttons: true,
                    ajaxOptions: {
                        type: 'get',
                        //type: 'put',
                        //dataType: 'json'
                    },
                    success: function(response, newValue) {
                        //console.log(response);
                        if(response.indexOf("Set OK"))
                        {
                            var id = this.id;
                            //console.log(this.id);

                            $("#" + id).addClass('alert-warning');
                            var span = $("<span>", { class:"label label-warning offset1"}).append("changed");
                            $("#" + id).parent().append(span);
                            
                            setTimeout(function(){

                                $.ajax("serial.php?save=1",{
                                    success: function(data)
                                    {
                                        //console.log(data);
                                        $("#" + id).removeClass('alert-warning');
                                        span.removeClass('label-warning');

                                        if(data.indexOf("Parameters stored") != -1)
                                        {
                                            $("#" + id).addClass('alert-success');
                                            span.addClass('label-success');
                                            span.text("saved");
                                        }else{
                                            $("#" + id).addClass('label-important');
                                            span.addClass('label-important');
                                            span.text("error");
                                        }
                                    }
                                });
                            },2000);
                            setTimeout(function(){
                                span.remove();
                            },5000);
                        }
                    }
                });

                //setTimeout(function(){
                    loadJSON();
                //},500);
                $('.tooltip-custom').tooltipster();
            });
        </script>
    </head>

    <body>
        <div class="navbar navbar-static" >
            <div class="navbar-inner">
                <div class="container" style="width: auto;">
                    <ul class="nav" role="navigation">
                    <li class="dropdown">
                        <a class="dropdown-toggle" role="button" data-toggle="dropdown" href="#"><b>Menu</b><b class="caret"></b></a>
                        <ul class="dropdown-menu" role="menu" aria-labelledby="drop1">
                            <li><a tabindex="-1" href="#" onClick="startInverter()">Start Inverter</a></li>
                            <li><a tabindex="-1" href="#" onClick="stopInverter()">Stop Inverter</a></li>
                            <!--
                            <li><a tabindex="-1" href="#">Save Parameters to Flash</a></li>
                            <li><a tabindex="-1" href="#">Save Parameters from Flash</a></li>
                            -->
                            <li><a tabindex="-1" href="upload.html">Upload Parameters</a></li>
                            <li><a tabindex="-1" href="download.php">Download Parameters</a></li>
                            <li><a tabindex="-1" href="index.html">Advanced Parameters</a></li>
                            <!--
                            <li><a tabindex="-1" href="simple.html">Simple Parameters</a></li>
                            -->
                            <!--
                            <li><a tabindex="-1" href="graph.html">Show Graph</a></li>
                            -->
                            <li class="divider"></li>
                            <li><a tabindex="-1" href="schematics.html">View Schematics</a></li>
                            <li><a tabindex="-1" href="wiring.html">Wiring Diagram</a></li>
                            <li><a tabindex="-1" href="encoder.html">Build Encoder</a></li>
                        </ul>
                    </li>
                    <li>
                        <div id="title">
                            <h3 class="label" id="title">Inverter Console</h3>
                            <span id="titleStatus" class="label offset1"></span>
                        </div>
                    </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row-fluid">
        <div class="span1"></div>
        <div class="span10">
            <div id="connection" style="display: none;">
                <center>
                <img src="img/connection.jpg" class="thumbnail" width="80%" height="80%"/>
                <br/><br/>
                <div class="btn-group">
                    <button class="btn btn-warning">Warning</button>
                    <button class="btn">Do not connect 5 volt power to serial connection (3.3 volt only)</button>
                </div>
                </center>
            </div>
            <table class="table table-bordered table-striped table-hover" style="display: none;background-color:#e6e6e6;" id="parameters">
            </table>
        </div>
        <div class="span1"></div>
        </div>
    </body>
</html>