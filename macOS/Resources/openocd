#!/bin/sh

if [ ! -f "/usr/local/gcc_arm/openocd/bin/openocd" ]; then
    pkgutil --expand ~/Downloads/gnuarmeclipse-openocd-osx-0.10.0-201601101000-dev.pkg /usr/local/gcc_arm/openocd/
    cd /usr/local/gcc_arm/openocd/
    cat Payload | gzip -d | cpio -id
    rm Bom
    rm PackageInfo
    rm Payload
else
    export PATH="$PATH:/usr/local/gcc_arm/openocd/bin/"
    cd /usr/local/gcc_arm/openocd/scripts/
    openocd -f ./interface/olimex-arm-usb-ocd-h.cfg -f ./board/olimex_stm32_h103.cfg -c "program $HOME/Documents/firmware/stm32_loader.bin reset exit"
fi
